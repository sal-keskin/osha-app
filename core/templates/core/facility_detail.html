{% extends 'core/base.html' %}

{% block content %}
<style>
    /* ===== shadcn/ui Zinc Theme - Design System ===== */
    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');

    :root {
        --background: #ffffff;
        --foreground: #09090b;
        --card: #ffffff;
        --card-foreground: #09090b;
        --border: #e4e4e7;
        --primary: #18181b;
        --primary-foreground: #fafafa;
        --muted: #f4f4f5;
        --muted-foreground: #71717a;
        --destructive: #ef4444;
        --destructive-foreground: #fef2f2;
        --radius: 0.5rem;
    }

    * {
        font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    }

    /* Hero Header */
    .facility-hero {
        background: var(--card);
        border-radius: var(--radius);
        padding: 24px;
        margin-bottom: 20px;
        border: 1px solid var(--border);
        box-shadow: none;
    }

    .hero-breadcrumb {
        margin-bottom: 16px;
    }

    .back-link {
        color: var(--muted-foreground);
        text-decoration: none;
        font-size: 0.875rem;
        display: inline-flex;
        align-items: center;
        gap: 4px;
        transition: color 0.15s;
    }

    .back-link:hover {
        color: var(--foreground);
    }

    .hero-title-row {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 20px;
        flex-wrap: wrap;
        gap: 12px;
    }

    .hero-title-left {
        display: flex;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
    }

    .facility-name {
        font-size: 1.5rem;
        font-weight: 700;
        color: var(--foreground);
        margin: 0;
        letter-spacing: -0.025em;
    }

    .hazard-badge {
        padding: 4px 12px;
        border-radius: 9999px;
        font-size: 0.75rem;
        font-weight: 500;
        border: 1px solid var(--border);
    }

    .hazard-badge.low {
        background: var(--muted);
        color: var(--muted-foreground);
        border-color: var(--border);
    }

    .hazard-badge.medium {
        background: #fef3c7;
        color: #92400e;
        border-color: #fde68a;
    }

    .hazard-badge.high {
        background: #fef2f2;
        color: #991b1b;
        border-color: #fecaca;
    }

    .edit-btn {
        background: var(--background);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 8px 14px;
        color: var(--muted-foreground);
        font-size: 0.875rem;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        text-decoration: none;
        transition: all 0.15s;
    }

    .edit-btn:hover {
        background: var(--muted);
        color: var(--foreground);
        border-color: var(--border);
    }

    /* Stats Ribbon */
    .stats-ribbon {
        display: flex;
        gap: 8px;
        overflow-x: auto;
        padding-bottom: 4px;
        -webkit-overflow-scrolling: touch;
        scrollbar-width: none;
        -ms-overflow-style: none;
    }

    .stats-ribbon::-webkit-scrollbar {
        display: none;
    }

    .stat-chip {
        background: var(--muted);
        border: 1px solid var(--border);
        border-radius: 9999px;
        padding: 8px 14px;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        white-space: nowrap;
        font-size: 0.8125rem;
        font-weight: 500;
        color: var(--foreground);
        flex-shrink: 0;
    }

    .stat-chip .emoji {
        font-size: 0.875rem;
    }

    .stat-chip.stat-green {
        background: var(--muted);
        color: var(--foreground);
        border-color: var(--border);
    }

    .stat-chip.stat-orange {
        background: #fffbeb;
        color: #92400e;
        border-color: #fde68a;
    }

    .stat-chip.stat-red {
        background: #fef2f2;
        color: #991b1b;
        border-color: #fecaca;
    }

    .stat-chip.stat-blue {
        background: var(--muted);
        color: var(--foreground);
        border-color: var(--border);
    }

    @media (max-width: 768px) {
        .stats-ribbon {
            gap: 6px;
        }

        .stat-chip {
            padding: 6px 10px;
            font-size: 0.75rem;
        }

        .stat-chip .emoji {
            font-size: 0.8rem;
        }
    }

    /* Tabs - Minimalist */
    .dashboard-tabs {
        background: var(--card);
        border-radius: var(--radius);
        border: 1px solid var(--border);
        overflow: hidden;
        box-shadow: none;
    }

    .tab-nav {
        display: flex;
        border-bottom: 1px solid var(--border);
        background: var(--background);
        overflow-x: auto;
    }

    .tab-btn {
        padding: 14px 20px;
        border: none;
        background: transparent;
        font-weight: 500;
        color: var(--muted-foreground);
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: all 0.15s;
        white-space: nowrap;
        font-size: 0.875rem;
    }

    .tab-btn:hover {
        color: var(--foreground);
        background: var(--muted);
    }

    .tab-btn.active {
        color: var(--foreground);
        border-bottom-color: var(--primary);
        background: var(--background);
        font-weight: 600;
    }

    .tab-content {
        display: none;
        padding: 24px;
    }

    .tab-content.active {
        display: block;
    }

    /* Overview Grid */
    .overview-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 16px;
    }

    @media (min-width: 768px) {
        .overview-grid {
            grid-template-columns: 2fr 1fr;
        }
    }

    @media (max-width: 767px) {
        .overview-grid {
            display: flex;
            flex-direction: column;
        }

        .quick-actions-card {
            order: 1;
            margin-bottom: 12px;
        }

        .location-card {
            order: 2;
        }
    }

    /* Info Cards - Flat Design */
    .info-card {
        background: var(--muted);
        border-radius: var(--radius);
        padding: 20px;
        border: 1px solid var(--border);
    }

    .info-card-title {
        font-weight: 600;
        color: var(--foreground);
        margin-bottom: 16px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.875rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .map-container {
        background: var(--muted);
        border-radius: var(--radius);
        height: 180px;
        overflow: hidden;
        border: 1px solid var(--border);
        margin-bottom: 12px;
        position: relative;
    }

    .map-container iframe {
        width: 100%;
        height: 100%;
        border: 0;
    }

    .map-placeholder-empty {
        background: var(--muted);
        border-radius: var(--radius);
        height: 180px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: var(--muted-foreground);
        font-size: 2rem;
        margin-bottom: 12px;
        border: 1px solid var(--border);
    }

    .address-text {
        color: var(--muted-foreground);
        font-size: 0.875rem;
        margin-bottom: 12px;
    }

    .coords-text {
        color: var(--muted-foreground);
        font-size: 0.8125rem;
        margin-bottom: 8px;
    }

    .map-btn {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: var(--primary);
        color: var(--primary-foreground);
        padding: 10px 16px;
        border-radius: var(--radius);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.875rem;
        transition: opacity 0.15s;
    }

    .map-btn:hover {
        opacity: 0.9;
        color: var(--primary-foreground);
    }

    .detail-row {
        display: flex;
        justify-content: space-between;
        padding: 12px 0;
        border-bottom: 1px solid var(--border);
    }

    .detail-row:last-child {
        border-bottom: none;
    }

    .detail-label {
        color: var(--muted-foreground);
        font-size: 0.875rem;
    }

    .detail-value {
        font-weight: 600;
        color: var(--foreground);
    }

    /* Quick Actions - 2x2 Grid */
    .quick-actions {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 10px;
    }

    @media (max-width: 480px) {
        .quick-actions {
            grid-template-columns: 1fr;
        }
    }

    .action-btn {
        display: flex;
        align-items: center;
        gap: 8px;
        padding: 12px 14px;
        border-radius: var(--radius);
        text-decoration: none;
        font-weight: 500;
        font-size: 0.875rem;
        transition: all 0.15s;
        border: 1px solid var(--border);
        background: var(--background);
        color: var(--foreground);
    }

    .action-btn:hover {
        background: var(--muted);
        border-color: var(--border);
    }

    .action-btn.primary {
        background: var(--primary);
        color: var(--primary-foreground);
        border-color: var(--primary);
    }

    .action-btn.primary:hover {
        opacity: 0.9;
    }

    .action-btn.success {
        background: var(--foreground);
        color: var(--background);
        border-color: var(--foreground);
    }

    .action-btn.success:hover {
        opacity: 0.9;
    }

    /* Workers Table */
    .workers-table {
        width: 100%;
        border-collapse: collapse;
    }

    .workers-table th,
    .workers-table td {
        padding: 12px;
        text-align: left;
        border-bottom: 1px solid var(--border);
        font-size: 0.875rem;
    }

    .workers-table th {
        background: var(--muted);
        font-weight: 500;
        color: var(--muted-foreground);
        font-size: 0.8125rem;
        text-transform: uppercase;
        letter-spacing: 0.025em;
    }

    .workers-table tr:hover {
        background: var(--muted);
    }

    .worker-name {
        font-weight: 600;
        color: var(--foreground);
    }

    .status-badge {
        padding: 4px 10px;
        border-radius: var(--radius);
        font-size: 0.75rem;
        font-weight: 500;
        border: 1px solid transparent;
    }

    .status-badge.valid {
        background: var(--muted);
        color: var(--foreground);
        border-color: var(--border);
    }

    .status-badge.expired {
        background: #fef2f2;
        color: #991b1b;
        border-color: #fecaca;
    }

    .status-badge.missing {
        background: var(--muted);
        color: var(--muted-foreground);
        border-color: var(--border);
    }

    /* Assessments */
    .assessment-card {
        background: var(--muted);
        border: 1px solid var(--border);
        border-radius: var(--radius);
        padding: 16px;
        margin-bottom: 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        flex-wrap: wrap;
        gap: 12px;
    }

    .assessment-info h4 {
        margin: 0 0 4px 0;
        font-weight: 600;
        color: var(--foreground);
        font-size: 0.9375rem;
    }

    .assessment-meta {
        font-size: 0.8125rem;
        color: var(--muted-foreground);
    }

    .assessment-actions {
        display: flex;
        gap: 8px;
    }

    .btn-sm {
        padding: 8px 12px;
        border-radius: var(--radius);
        font-size: 0.8125rem;
        font-weight: 500;
        text-decoration: none;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: all 0.15s;
    }

    .btn-outline {
        background: var(--background);
        border: 1px solid var(--border);
        color: var(--foreground);
    }

    .btn-outline:hover {
        background: var(--muted);
    }

    .btn-primary {
        background: var(--primary);
        color: var(--primary-foreground);
        border: 1px solid var(--primary);
    }

    .btn-primary:hover {
        opacity: 0.9;
    }

    .empty-state {
        text-align: center;
        padding: 40px;
        color: var(--muted-foreground);
    }

    .empty-state i {
        font-size: 2.5rem;
        margin-bottom: 12px;
        opacity: 0.4;
    }
</style>

<!-- Hero Header -->
<div class="facility-hero">
    <div class="hero-breadcrumb">
        <a href="{% url 'workplace_detail' workplace.pk %}" class="back-link">
            <i class="bi bi-arrow-left"></i> {{ workplace.name }}
        </a>
    </div>

    <div class="hero-title-row">
        <div class="hero-title-left">
            <h1 class="facility-name">{{ facility.name }}</h1>
            <span
                class="hazard-badge {% if workplace.hazard_class == 'LOW' %}low{% elif workplace.hazard_class == 'MEDIUM' %}medium{% else %}high{% endif %}">
                {{ workplace.get_hazard_class_display }}
            </span>
        </div>
        <a href="{% url 'facility_update' facility.pk %}" class="edit-btn">
            <i class="bi bi-pencil"></i> D√ºzenle
        </a>
    </div>

    <div class="stats-ribbon">
        <div class="stat-chip stat-blue">
            <span class="emoji">üë•</span> {{ worker_count }} √áalƒ±≈üan
        </div>
        <div
            class="stat-chip {% if education_percentage >= 90 %}stat-green{% elif education_percentage >= 70 %}stat-orange{% else %}stat-red{% endif %}">
            <span class="emoji">üéì</span> %{{ education_percentage }} Eƒüitim
        </div>
        <div
            class="stat-chip {% if examination_percentage >= 90 %}stat-green{% elif examination_percentage >= 70 %}stat-orange{% else %}stat-red{% endif %}">
            <span class="emoji">‚ù§Ô∏è‚Äçü©π</span> %{{ examination_percentage }} Muayene
        </div>
        <div class="stat-chip">
            <span class="emoji">üõ°Ô∏è</span> {{ assessment_count }} Deƒüerlendirme
        </div>
        {% if facility.address %}
        <div class="stat-chip">
            <span class="emoji">üìç</span> {{ facility.address|truncatechars:30 }}
        </div>
        {% endif %}
    </div>
</div>

<!-- Tabs -->
<div class="dashboard-tabs">
    <div class="tab-nav">
        <button class="tab-btn active" onclick="showTab('overview')">
            <i class="bi bi-house me-2"></i> Genel
        </button>
        <button class="tab-btn" onclick="showTab('workers')">
            <i class="bi bi-people me-2"></i> √áalƒ±≈üanlar ({{ worker_count }})
        </button>
        <button class="tab-btn" onclick="showTab('assessments')">
            <i class="bi bi-shield-check me-2"></i> Risk Deƒüerlendirme ({{ assessment_count }})
        </button>
    </div>

    <!-- Tab 1: Overview -->
    <div id="tab-overview" class="tab-content active">
        <div class="overview-grid">
            <!-- Quick Actions (First on Mobile) -->
            <div class="quick-actions-card">
                <div class="info-card">
                    <div class="info-card-title"><i class="bi bi-lightning"></i> Hƒ±zlƒ± ƒ∞≈ülemler</div>
                    <div class="quick-actions">
                        <a href="{% url 'worker_create' %}?facility_id={{ facility.pk }}" class="action-btn primary">
                            <i class="bi bi-person-plus"></i> √áalƒ±≈üan Ekle
                        </a>
                        <button type="button" class="action-btn success" data-bs-toggle="modal"
                            data-bs-target="#newAssessmentModal">
                            <i class="bi bi-shield-plus"></i> Yeni Deƒüerlendirme
                        </button>
                        <a href="{% url 'facility_qr_code' facility.pk %}" class="action-btn">
                            <i class="bi bi-qr-code"></i> QR Kodu ƒ∞ndir
                        </a>
                        <a href="{% url 'facility_engagements' facility.pk %}" class="action-btn">
                            <i class="bi bi-chat-dots"></i> Bildirimler
                        </a>
                        <a href="{% url 'public_safety_forum' facility.uuid %}" class="action-btn" target="_blank">
                            <i class="bi bi-megaphone"></i> Topluluk Forumu
                        </a>
                        <a href="{% url 'facility_update' facility.pk %}" class="action-btn">
                            <i class="bi bi-gear"></i> Birim Ayarlarƒ±
                        </a>
                        <a href="#" class="action-btn" onclick="window.print(); return false;">
                            <i class="bi bi-printer"></i> Yazdƒ±r
                        </a>
                    </div>
                </div>
            </div>

            <!-- Location & Details (Second on Mobile) -->
            <div class="location-card" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Map Card -->
                <div class="info-card">
                    <div class="info-card-title"><i class="bi bi-geo-alt"></i> Konum</div>
                    {% if lat and lng %}
                    <div class="map-container">
                        <iframe src="https://maps.google.com/maps?q={{ lat }},{{ lng }}&hl=tr&z=15&output=embed"
                            allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade">
                        </iframe>
                    </div>
                    <div class="coords-text">Lat: {{ lat_display }}, Lng: {{ lng_display }}</div>
                    {% if facility.address %}
                    <div class="address-text">{{ facility.address }}</div>
                    {% endif %}
                    <a href="https://www.google.com/maps/search/?api=1&query={{ lat }},{{ lng }}" target="_blank"
                        class="map-btn">
                        <i class="bi bi-box-arrow-up-right"></i> Google Maps'te A√ß
                    </a>
                    {% else %}
                    <div class="map-placeholder-empty">
                        <i class="bi bi-geo-alt"></i>
                    </div>
                    <span class="text-muted">Koordinat bilgisi girilmemi≈ü</span>
                    {% if facility.address %}
                    <div class="address-text">{{ facility.address }}</div>
                    {% endif %}
                    {% endif %}
                </div>

                <!-- Details Card -->
                <div class="info-card">
                    <div class="info-card-title"><i class="bi bi-info-circle"></i> Detaylar</div>
                    <div class="detail-row">
                        <span class="detail-label">ƒ∞≈üyeri</span>
                        <span class="detail-value">{{ workplace.name }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label">Tehlike Sƒ±nƒ±fƒ±</span>
                        <span class="detail-value">{{ workplace.get_hazard_class_display }}</span>
                    </div>
                    {% if lat_display and lng_display %}
                    <div class="detail-row">
                        <span class="detail-label">Koordinatlar</span>
                        <span class="detail-value">{{ lat_display }}, {{ lng_display }}</span>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Tab 2: Workers -->
    <div id="tab-workers" class="tab-content">
        {% if workers %}
        <div class="table-responsive">
            <table class="workers-table">
                <thead>
                    <tr>
                        <th>Ad Soyad</th>
                        <th>TCKN</th>
                        <th>Eƒüitim</th>
                        <th>Muayene</th>
                        <th>ƒ∞≈ülemler</th>
                    </tr>
                </thead>
                <tbody>
                    {% for worker in workers %}
                    <tr>
                        <td><span class="worker-name">{{ worker.name }}</span></td>
                        <td>{{ worker.tckn }}</td>
                        <td>
                            <span
                                class="status-badge {% if worker.education_status == 'Ge√ßerli' %}valid{% elif worker.education_status == 'S√ºresi Dolmu≈ü' %}expired{% else %}missing{% endif %}">
                                {{ worker.education_status }}
                            </span>
                        </td>
                        <td>
                            <span
                                class="status-badge {% if worker.examination_status == 'Ge√ßerli' %}valid{% elif worker.examination_status == 'S√ºresi Dolmu≈ü' %}expired{% else %}missing{% endif %}">
                                {{ worker.examination_status }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'worker_update' worker.pk %}" class="btn-sm btn-outline">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <div class="empty-state">
            <i class="bi bi-people"></i>
            <p>Bu birimde hen√ºz √ßalƒ±≈üan bulunmuyor.</p>
            <a href="{% url 'worker_create' %}?facility_id={{ facility.pk }}" class="btn-primary btn-sm">
                <i class="bi bi-plus"></i> √áalƒ±≈üan Ekle
            </a>
        </div>
        {% endif %}
    </div>

    <!-- Tab 3: Assessments -->
    <div id="tab-assessments" class="tab-content">
        <div style="margin-bottom: 16px;">
            <button type="button" class="btn-primary btn-sm" data-bs-toggle="modal"
                data-bs-target="#newAssessmentModal">
                <i class="bi bi-plus"></i> Yeni Deƒüerlendirme
            </button>
        </div>

        {% if assessment_sessions %}
        {% for session in assessment_sessions %}
        <div class="assessment-card">
            <div class="assessment-info">
                <h4>{{ session.title }}</h4>
                <div class="assessment-meta">
                    {{ session.tool.title }} &bull; {{ session.created_at|date:"d.m.Y" }} &bull;
                    <span class="{% if session.status == 'DRAFT' %}text-warning{% else %}text-success{% endif %}">
                        {{ session.get_status_display }}
                    </span>
                </div>
            </div>
            <div class="assessment-actions">
                <a href="{% url 'assessment_session_run' session.pk %}" class="btn-sm btn-primary">
                    <i class="bi bi-play-fill"></i> Devam Et
                </a>
                <a href="{% url 'assessment_status' session.pk %}" class="btn-sm btn-outline">
                    <i class="bi bi-bar-chart"></i>
                </a>
            </div>
        </div>
        {% endfor %}
        {% else %}
        <div class="empty-state">
            <i class="bi bi-shield-check"></i>
            <p>Hen√ºz risk deƒüerlendirmesi yapƒ±lmamƒ±≈ü.</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- New Assessment Modal -->
<div class="modal fade" id="newAssessmentModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content" style="border-radius: 16px;">
            <div class="modal-header border-0"
                style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border-radius: 16px 16px 0 0;">
                <h5 class="modal-title"><i class="bi bi-shield-plus me-2"></i> Yeni Risk Deƒüerlendirmesi</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <form method="post" action="{% url 'assessment_session_create' facility.pk %}" id="assessmentForm">
                {% csrf_token %}
                <input type="hidden" name="workflow_type" id="workflowType" value="LIBRARY">
                <div class="modal-body" style="padding: 24px;">
                    <!-- Title -->
                    <div class="mb-4">
                        <label class="form-label fw-semibold">Deƒüerlendirme Ba≈ülƒ±ƒüƒ±</label>
                        {{ session_form.title }}
                    </div>

                    <!-- Workflow Selection Cards -->
                    <div class="mb-4">
                        <label class="form-label fw-semibold">Y√∂ntem Se√ßimi</label>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px;">
                            <div class="workflow-card selected" id="cardLibrary" onclick="selectWorkflow('LIBRARY')">
                                <div class="workflow-icon">üìö</div>
                                <div class="workflow-title">K√ºt√ºphaneden Se√ßerek</div>
                                <div class="workflow-desc">Hazƒ±r risk k√ºt√ºphanesinden se√ßim yaparak ilerleyin.</div>
                            </div>
                            <div class="workflow-card" id="cardTemplate" onclick="selectWorkflow('TEMPLATE')">
                                <div class="workflow-icon">üìù</div>
                                <div class="workflow-title">Hazƒ±r ≈ûablon ƒ∞le</div>
                                <div class="workflow-desc">Soru-cevap formunu doldurarak ilerleyin.</div>
                            </div>
                        </div>
                    </div>

                    <!-- Template Selection (Conditional) -->
                    <div class="mb-4" id="templateSelectGroup" style="display: none;">
                        <label class="form-label fw-semibold">Deƒüerlendirme ≈ûablonu</label>
                        <select name="tool" id="toolSelect" class="form-select">
                            <option value="">Se√ßiniz...</option>
                            {% for tool in risk_tools %}
                            <option value="{{ tool.pk }}">{{ tool.title }}</option>
                            {% endfor %}
                        </select>
                        <small class="text-muted">Kullanƒ±lacak soru-cevap ≈üablonunu se√ßin.</small>
                    </div>

                    <!-- Scoring Method -->
                    <div class="mb-3">
                        <label class="form-label fw-semibold">Risk Skoru Hesaplama Y√∂ntemi</label>
                        <div class="scoring-toggle">
                            <input type="radio" name="scoring_method" id="scoringKinney" value="KINNEY" checked>
                            <label for="scoringKinney" class="scoring-option">
                                <span class="scoring-name">Fine-Kinney</span>
                                <span class="scoring-formula">P √ó F √ó S</span>
                            </label>
                            <input type="radio" name="scoring_method" id="scoringMatrix" value="MATRIX">
                            <label for="scoringMatrix" class="scoring-option">
                                <span class="scoring-name">L-Matris (5√ó5)</span>
                                <span class="scoring-formula">P √ó S</span>
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer border-0" style="padding: 16px 24px;">
                    <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">ƒ∞ptal</button>
                    <button type="submit" class="btn btn-success" style="min-width: 140px;">
                        <i class="bi bi-play-fill me-1"></i> Ba≈ülat
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<style>
    .workflow-card {
        border: 2px solid #e5e7eb;
        border-radius: 12px;
        padding: 16px;
        cursor: pointer;
        transition: all 0.2s ease;
        text-align: center;
    }

    .workflow-card:hover {
        border-color: #10b981;
        background: #f0fdf4;
    }

    .workflow-card.selected {
        border-color: #10b981;
        background: #ecfdf5;
        box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.2);
    }

    .workflow-icon {
        font-size: 2rem;
        margin-bottom: 8px;
    }

    .workflow-title {
        font-weight: 600;
        font-size: 1rem;
        color: #111827;
        margin-bottom: 4px;
    }

    .workflow-desc {
        font-size: 0.8rem;
        color: #6b7280;
        line-height: 1.3;
    }

    .scoring-toggle {
        display: flex;
        gap: 0;
        background: #f3f4f6;
        border-radius: 10px;
        padding: 4px;
    }

    .scoring-toggle input[type="radio"] {
        display: none;
    }

    .scoring-option {
        flex: 1;
        display: flex;
        flex-direction: column;
        align-items: center;
        padding: 10px 16px;
        cursor: pointer;
        border-radius: 8px;
        transition: all 0.2s;
    }

    .scoring-toggle input[type="radio"]:checked+.scoring-option {
        background: white;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
    }

    .scoring-name {
        font-weight: 600;
        font-size: 0.9rem;
        color: #374151;
    }

    .scoring-formula {
        font-size: 0.75rem;
        color: #6b7280;
    }
</style>

<script>
    function showTab(tabName) {
        // Hide all tab contents
        document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
        // Deactivate all buttons
        document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));

        // Show selected tab
        document.getElementById('tab-' + tabName).classList.add('active');
        // Activate button
        event.currentTarget.classList.add('active');
    }

    function selectWorkflow(type) {
        document.getElementById('workflowType').value = type;

        // Update card selection
        document.getElementById('cardLibrary').classList.toggle('selected', type === 'LIBRARY');
        document.getElementById('cardTemplate').classList.toggle('selected', type === 'TEMPLATE');

        // Toggle template selector visibility
        const templateGroup = document.getElementById('templateSelectGroup');
        const toolSelect = document.getElementById('toolSelect');

        if (type === 'TEMPLATE') {
            templateGroup.style.display = 'block';
            toolSelect.setAttribute('required', 'required');
        } else {
            templateGroup.style.display = 'none';
            toolSelect.removeAttribute('required');
            toolSelect.value = '';
        }
    }
</script>
{% endblock %}